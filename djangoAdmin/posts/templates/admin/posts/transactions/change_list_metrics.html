{% extends "admin/change_list.html" %} {% block object-tools-items %}
{{block.super }}
<ul>
  <li>
    <a href="{{ import_url }}" class="addlink">Import JSON</a>
  </li>
</ul>
{% endblock %} {% block content %}
<style>
  .metrics-card {
    margin-bottom: 20px;
    padding: 15px 20px;
    border: 1px solid #e5e5e5;
    border-radius: 10px;
  }

  .metrics-header {
    font-size: 18px;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
  }

  .metric-box {
    background: white;
    border-radius: 8px;
    padding: 10px 12px;
    border: 1px solid #eee;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .metric-title {
    font-weight: 500;
    font-size: 14px;
    color: #333;
  }

  .metric-value {
    font-size: 22px;
    font-weight: bold;
    color: #0074d9;
  }

  .chart-container {
    margin: 20px auto;
    width: 90%;
    max-width: 800px;
  }
</style>

<div class="metrics-card">
  <div class="metrics-header">Metrics Overview</div>

  <div class="metrics-grid">
    <div class="metric-box">
      <div class="metric-title">Transactions Imported</div>
      <div class="metric-value">{{ metrics.transactions.imported }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Transactions Failed</div>
      <div class="metric-value">{{ metrics.transactions.failed }}</div>
    </div>

    {% if metrics.types %}
    <div class="metric-box">
      <div class="metric-title">Types Created</div>
      <div class="metric-value">{{ metrics.types.created }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Types Updated</div>
      <div class="metric-value">{{ metrics.types.updated }}</div>
    </div>
    {% endif %}

    <div class="metric-box">
      <div class="metric-title">Notifications Success</div>
      <div class="metric-value">{{ metrics.notifications.success }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Notifications Failed</div>
      <div class="metric-value">{{ metrics.notifications.failed }}</div>
    </div>

    <div class="metric-box">
      <div class="metric-title">Alerts Total</div>
      <div class="metric-value">{{ metrics.alerts.total }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Alerts Failed</div>
      <div class="metric-value">{{ metrics.alerts.failed }}</div>
    </div>

    {% if metrics.queue %}
    <div class="metric-box">
      <div class="metric-title">Queue: Queued</div>
      <div class="metric-value">{{ metrics.queue.queued }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Queue: Processing</div>
      <div class="metric-value">{{ metrics.queue.processing }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Queue: Processed</div>
      <div class="metric-value">{{ metrics.queue.processed }}</div>
    </div>
    <div class="metric-box">
      <div class="metric-title">Queue: Failed</div>
      <div class="metric-value">{{ metrics.queue.failed }}</div>
    </div>
    {% endif %}
  </div>
</div>

<div class="chart-container">
  <canvas id="transactionsChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('transactionsChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [
        'Imported',
        'Failed',
        'Notifications Success',
        'Notifications Failed',
        'Alerts Total',
        'Alerts Failed'
        {% if metrics.queue %},
        'Queue Queued',
        'Queue Processing',
        'Queue Processed',
        'Queue Failed'
        {% endif %}
      ],
      datasets: [{
        label: 'Metrics',
        data: [
          {{ metrics.transactions.imported }},
          {{ metrics.transactions.failed }},
          {{ metrics.notifications.success }},
          {{ metrics.notifications.failed }},
          {{ metrics.alerts.total }},
          {{ metrics.alerts.failed }}
          {% if metrics.queue %},
          {{ metrics.queue.queued }},
          {{ metrics.queue.processing }},
          {{ metrics.queue.processed }},
          {{ metrics.queue.failed }}
          {% endif %}
        ],
        backgroundColor: [
          'rgba(0, 128, 255, 0.5)',
          'rgba(255, 99, 132, 0.5)',
          'rgba(0, 200, 100, 0.5)',
          'rgba(255, 165, 0, 0.5)',
          'rgba(153, 102, 255, 0.5)',
          'rgba(255, 206, 86, 0.5)',
          {% if metrics.queue %}
          'rgba(75, 192, 192, 0.5)',
          'rgba(255, 159, 64, 0.5)',
          'rgba(54, 162, 235, 0.5)',
          'rgba(255, 99, 132, 0.5)'
          {% endif %}
        ],
        borderColor: 'rgba(0, 0, 0, 0.1)',
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(0,0,0,0.7)',
          titleColor: '#fff',
          bodyColor: '#fff'
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

{{ block.super }} {% endblock %}
